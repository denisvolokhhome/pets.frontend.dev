<form
  #editPet="ngForm"
  enctype="multipart/form-data"
  [formGroup]="form"
  (ngSubmit)="submit()"
  class="modern-pet-form"
>
  <div class="modal-body">
    <div class="pet-form-header">
      <div class="pet-form-icon">
        <i class="material-icons">edit</i>
      </div>
      <h2 class="pet-form-title">Edit Pet</h2>
      <p class="pet-form-subtitle">Update your pet's information</p>
    </div>

    <div class="grid grid-cols-1 lg:grid-cols-12 gap-4">
      <!-- Image Upload Section -->
      <div class="lg:col-span-5">
        <div class="form-section">
          <label class="section-label">
            <i class="bi bi-image mr-2"></i>Pet Photo
          </label>
          <div class="image-upload-modern">
            <div
              class="image-preview-modern"
              [class.has-image]="image_path"
              [class.has-existing-image]="!image_path && pet?.image_path"
              [style.background-image]="image_path ? 'url(' + image_path + ')' : (pet?.image_path ? 'url(' + getImageUrl(pet.image_path) + ')' : 'none')"
            >
              <div class="upload-placeholder" *ngIf="!image_path">
                <i class="bi bi-cloud-upload"></i>
                <span class="upload-text">{{ pet?.image_path ? 'Change Photo' : 'Click to upload' }}</span>
                <span class="upload-hint">JPG, PNG up to 5MB</span>
              </div>
              <div class="image-overlay-modern" (click)="selectImage.click()">
                <i class="bi bi-camera"></i>
                <span>{{ image_path ? 'Change' : (pet?.image_path ? 'Change' : 'Upload') }}</span>
              </div>
            </div>
            <input
              type="file"
              id="image"
              class="hidden"
              (change)="readURL($event)"
              formControlName="image"
              #selectImage
              accept="image/*"
            />
          </div>
        </div>
      </div>

      <!-- Pet Details Section -->
      <div class="lg:col-span-7">
        <div class="form-section">
          <label class="section-label">
            <i class="bi bi-info-circle mr-2"></i>Basic Information
          </label>
          
          <div class="form-group-modern">
            <label for="petName" class="form-label-modern">Pet Name *</label>
            <input
              type="text"
              id="petName"
              class="form-control-modern"
              placeholder="Enter your pet's name"
              formControlName="name"
              appFocus
            />
          </div>

          <div class="grid grid-cols-1 md:grid-cols-2 gap-3">
            <div class="form-group-modern">
              <label class="form-label-modern">Breed</label>
              <div class="read-only-field">
                <i class="bi bi-lock-fill mr-2"></i>
                <span>{{ getBreedName() || 'Not specified' }}</span>
              </div>
            </div>

            <div class="form-group-modern">
              <label class="form-label-modern">Date of Birth</label>
              <div class="read-only-field">
                <i class="bi bi-lock-fill mr-2"></i>
                <span>{{ pet?.date_of_birth ? (pet.date_of_birth | date:'MMM d, yyyy') : 'Not specified' }}</span>
              </div>
            </div>
          </div>

          <div class="form-group-modern">
            <label class="form-label-modern">Gender</label>
            <div class="gender-display">
              <div class="gender-badge" 
                   [class.male]="pet?.gender === 'm' || pet?.gender === 'Male'" 
                   [class.female]="pet?.gender === 'f' || pet?.gender === 'Female'"
                   [class.not-specified]="!pet?.gender || (pet?.gender !== 'm' && pet?.gender !== 'f' && pet?.gender !== 'Male' && pet?.gender !== 'Female')">
                <i class="bi" 
                   [class.bi-gender-male]="pet?.gender === 'm' || pet?.gender === 'Male'" 
                   [class.bi-gender-female]="pet?.gender === 'f' || pet?.gender === 'Female'"
                   [class.bi-question-circle]="!pet?.gender || (pet?.gender !== 'm' && pet?.gender !== 'f' && pet?.gender !== 'Male' && pet?.gender !== 'Female')"></i>
                <span>{{ 
                  pet?.gender === 'm' || pet?.gender === 'Male' ? 'Male' : 
                  pet?.gender === 'f' || pet?.gender === 'Female' ? 'Female' : 
                  'Not specified' 
                }}</span>
              </div>
              <div class="age-type-badge" *ngIf="pet?.is_puppy === 1">
                <i class="bi bi-heart-fill"></i>
                <span>Young</span>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Additional Details -->
    <div class="grid grid-cols-1 lg:grid-cols-2 gap-4 mt-2">
      <div class="form-group-modern">
        <label for="weight" class="form-label-modern">Weight (kg) *</label>
        <input
          type="text"
          id="weight"
          class="form-control-modern"
          placeholder="e.g., 25.5"
          formControlName="weight"
        />
      </div>

      <div class="form-group-modern">
        <label for="location" class="form-label-modern">Location *</label>
        <select
          id="location"
          class="form-control-modern form-select-modern"
          [formControl]="location_name"
        >
          <option value="">Select a location</option>
          <option *ngFor="let location of locations" [value]="location.name">
            {{ location.name }}
          </option>
        </select>
      </div>
    </div>

    <div class="grid grid-cols-1 gap-4 mt-2">
      <div class="form-group-modern">
        <label for="description" class="form-label-modern">Description</label>
        <textarea
          id="description"
          class="form-control-modern"
          rows="3"
          placeholder="Tell us about your pet's personality, habits, or any special notes..."
          formControlName="pet_desc"
          maxlength="200"
        ></textarea>
        <small class="char-count">{{ form.value.pet_desc?.length || 0 }}/200</small>
      </div>
    </div>

    <!-- Health Records -->
    <div class="form-section mt-4">
      <label class="section-label">
        <i class="bi bi-heart-pulse mr-2"></i>Health Records
      </label>
      <div class="health-checkboxes">
        <label class="checkbox-modern">
          <input type="checkbox" formControlName="has_vaccination" />
          <span class="checkbox-custom"></span>
          <span class="checkbox-label">Vaccinated</span>
        </label>
        <label class="checkbox-modern">
          <input type="checkbox" formControlName="has_birthcertificate" />
          <span class="checkbox-custom"></span>
          <span class="checkbox-label">Birth Certificate</span>
        </label>
        <label class="checkbox-modern">
          <input type="checkbox" formControlName="has_healthcertificate" />
          <span class="checkbox-custom"></span>
          <span class="checkbox-label">Health Certificate</span>
        </label>
        <label class="checkbox-modern">
          <input type="checkbox" formControlName="has_dewormed" />
          <span class="checkbox-custom"></span>
          <span class="checkbox-label">Dewormed</span>
        </label>
      </div>
    </div>
  </div>

  <div class="modal-footer-modern">
    <button type="button" class="btn-secondary-modern" (click)="modalClose()">
      <i class="bi bi-x-lg mr-2"></i>Cancel
    </button>
    <button type="submit" class="btn-primary-modern">
      <i class="bi bi-check-lg mr-2"></i>Update Pet
    </button>
  </div>
</form>
