<div class="pets-container">
  <!-- Header Section -->
  <header class="pets-header">
    <div class="header-left">
      <h1 class="page-title">
        <i class="bi bi-heart-fill"></i>
        Pets Management
      </h1>
    </div>
    
    <div class="header-center">
      <!-- Layout Switcher -->
      <div class="layout-switcher">
        <button 
          class="layout-btn"
          [class.active]="view === 'table'"
          (click)="changeLayout('table')"
          title="Table View">
          <i class="bi bi-table"></i>
        </button>
        <button 
          class="layout-btn"
          [class.active]="view === 'cards'"
          (click)="changeLayout('cards')"
          title="Card View">
          <i class="bi bi-postcard-heart"></i>
        </button>
      </div>
      
      <!-- Search -->
      <div class="search-container">
        <input
          type="text"
          class="search-input"
          placeholder="Search pets..."
          (input)="searchPets($event)"
          [(ngModel)]="term"
        />
        <i class="bi bi-search search-icon"></i>
      </div>
    </div>
    
    <div class="header-right">
      <button 
        class="fab-button fab-success"
        data-bs-toggle="modal"
        data-bs-target="#addPetModal"
        title="Add Pet">
        <i class="bi bi-plus-circle"></i>
      </button>
    </div>
  </header>

  <!-- Content Section -->
  <div class="pets-layout">
  <!-- Filters Sidebar -->
  <aside class="filters-sidebar">
    <div class="filters-header">
      <h3 class="filters-title">
        <i class="bi bi-funnel-fill"></i>
        Filters
      </h3>
      <button 
        *ngIf="hasActiveFilters()" 
        class="btn-clear-filters"
        (click)="clearFilters()"
        title="Clear all filters">
        <i class="bi bi-x-circle-fill"></i>
      </button>
    </div>

    <div class="filters-content">
      <!-- Location Filter -->
      <div class="filter-group">
        <label class="filter-label">
          <i class="bi bi-geo-alt-fill"></i>
          Location
        </label>
        <select 
          class="filter-select"
          [(ngModel)]="selectedLocation"
          (change)="onLocationFilterChange(selectedLocation)">
          <option value="">All</option>
          <option *ngFor="let location of locations" [value]="location.name">
            {{ location.name }}
          </option>
        </select>
      </div>

      <!-- Gender Filter -->
      <div class="filter-group">
        <label class="filter-label">
          <i class="bi bi-gender-ambiguous"></i>
          Gender
        </label>
        <div class="gender-buttons">
          <button 
            class="gender-btn"
            [class.active]="selectedGender === 'm'"
            (click)="onGenderFilterChange(selectedGender === 'm' ? '' : 'm')">
            <i class="bi bi-gender-male"></i>
            Male
          </button>
          <button 
            class="gender-btn"
            [class.active]="selectedGender === 'f'"
            (click)="onGenderFilterChange(selectedGender === 'f' ? '' : 'f')">
            <i class="bi bi-gender-female"></i>
            Female
          </button>
        </div>
      </div>

      <!-- Age Type Filter -->
      <div class="filter-group">
        <label class="filter-label">
          <i class="bi bi-calendar-heart"></i>
          Age Type
        </label>
        <div class="gender-buttons">
          <button 
            class="gender-btn"
            [class.active]="selectedAgeType === 'adult'"
            (click)="onAgeTypeFilterChange(selectedAgeType === 'adult' ? '' : 'adult')">
            <i class="bi bi-star-fill"></i>
            Adult
          </button>
          <button 
            class="gender-btn"
            [class.active]="selectedAgeType === 'young'"
            (click)="onAgeTypeFilterChange(selectedAgeType === 'young' ? '' : 'young')">
            <i class="bi bi-heart-fill"></i>
            Young
          </button>
        </div>
      </div>

      <!-- Health Records Filter -->
      <div class="filter-group">
        <label class="filter-label">
          <i class="bi bi-heart-pulse-fill"></i>
          Health Records
        </label>
        <div class="health-checkboxes">
          <label class="health-checkbox" for="filter-vaccination">
            <input 
              type="checkbox"
              id="filter-vaccination"
              [(ngModel)]="selectedHealthFilters.vaccination"
              (ngModelChange)="applyFilters()">
            <span class="checkbox-label">
              <i class="bi bi-shield-fill-check"></i>
              Vaccination
            </span>
          </label>
          <label class="health-checkbox" for="filter-microchip">
            <input 
              type="checkbox"
              id="filter-microchip"
              [(ngModel)]="selectedHealthFilters.microchip"
              (ngModelChange)="applyFilters()">
            <span class="checkbox-label">
              <i class="bi bi-cpu"></i>
              Microchip
            </span>
          </label>
          <label class="health-checkbox" for="filter-healthcertificate">
            <input 
              type="checkbox"
              id="filter-healthcertificate"
              [(ngModel)]="selectedHealthFilters.healthcertificate"
              (ngModelChange)="applyFilters()">
            <span class="checkbox-label">
              <i class="bi bi-file-medical"></i>
              Health Cert
            </span>
          </label>
          <label class="health-checkbox" for="filter-dewormed">
            <input 
              type="checkbox"
              id="filter-dewormed"
              [(ngModel)]="selectedHealthFilters.dewormed"
              (ngModelChange)="applyFilters()">
            <span class="checkbox-label">
              <i class="bi bi-capsule"></i>
              Dewormed
            </span>
          </label>
          <label class="health-checkbox" for="filter-birthcertificate">
            <input 
              type="checkbox"
              id="filter-birthcertificate"
              [(ngModel)]="selectedHealthFilters.birthcertificate"
              (ngModelChange)="applyFilters()">
            <span class="checkbox-label">
              <i class="bi bi-file-earmark-text"></i>
              Birth Cert
            </span>
          </label>
        </div>
      </div>
    </div>

    <!-- Results Count -->
    <div class="results-count" *ngIf="filteredPets">
      <i class="bi bi-check-circle-fill"></i>
      <span>{{ filteredPets.length }} of {{ pets.length }}</span>
    </div>
  </aside>

  <!-- Main Content -->
  <main class="pets-content">
    <div *ngIf="view == 'cards'">
      <div *ngIf="filteredPets && filteredPets.length > 0" class="row">
        <div
          app-pet-card
          (deletingPet)="deletePet($event)"
          (editingPet)="editPet($event)"
          class="col-xxl-4 col-lg-6 mt-3"
          *ngFor="let pet of filteredPets | searchPets : term; let i = index"
          [pet]="pet"
        ></div>
      </div>

      <div *ngIf="!filteredPets || filteredPets.length === 0" class="empty-state">
        <i class="bi bi-search"></i>
        <h3>No pets found</h3>
        <p *ngIf="hasActiveFilters()">Try adjusting your filters to see more results.</p>
        <p *ngIf="!hasActiveFilters()">Please add a pet to get started.</p>
        <button *ngIf="hasActiveFilters()" class="btn btn-primary" (click)="clearFilters()">
          Clear Filters
        </button>
      </div>
    </div>
    
    <div *ngIf="view == 'table'">
      <div class="table-container">
        <p-table 
          [value]="filteredPets | searchPets : term" 
          [paginator]="true" 
          [rows]="10"
          [rowsPerPageOptions]="[10, 25, 50, 100]"
          [showCurrentPageReport]="true"
          currentPageReportTemplate="Showing {first} to {last} of {totalRecords} pets"
          [globalFilterFields]="['name', 'breed_name', 'description', 'gender']"
          styleClass="p-datatable-sm p-datatable-striped"
          responsiveLayout="scroll"
          *ngIf="filteredPets && filteredPets.length > 0">
          
          <ng-template pTemplate="header">
            <tr>
              <th pSortableColumn="name">
                Name <p-sortIcon field="name"></p-sortIcon>
              </th>
              <th pSortableColumn="breed_name">
                Breed <p-sortIcon field="breed_name"></p-sortIcon>
              </th>
              <th pSortableColumn="description">
                Description <p-sortIcon field="description"></p-sortIcon>
              </th>
              <th pSortableColumn="date_of_birth">
                Date of Birth <p-sortIcon field="date_of_birth"></p-sortIcon>
              </th>
              <th pSortableColumn="gender">
                Gender <p-sortIcon field="gender"></p-sortIcon>
              </th>
              <th pSortableColumn="weight">
                Weight <p-sortIcon field="weight"></p-sortIcon>
              </th>
            </tr>
          </ng-template>
          
          <ng-template pTemplate="body" let-pet>
            <tr>
              <td>{{ pet.name }}</td>
              <td>{{ pet.breed_name }}</td>
              <td>{{ pet.description }}</td>
              <td>{{ pet.date_of_birth }}</td>
              <td>{{ pet.gender }}</td>
              <td>{{ pet.weight }}</td>
            </tr>
          </ng-template>
          
          <ng-template pTemplate="emptymessage">
            <tr>
              <td colspan="6" class="text-center">No pets found</td>
            </tr>
          </ng-template>
        </p-table>

        <div *ngIf="!filteredPets || filteredPets.length === 0" class="empty-state">
          <i class="bi bi-search"></i>
          <h3>No pets found</h3>
          <p *ngIf="hasActiveFilters()">Try adjusting your filters to see more results.</p>
          <p *ngIf="!hasActiveFilters()">Please add a pet to get started.</p>
          <button *ngIf="hasActiveFilters()" class="btn btn-primary" (click)="clearFilters()">
            Clear Filters
          </button>
        </div>
      </div>
    </div>
  </main>
  </div>
</div>

<!-- TODO: Make single modal for different actions -->
<div
  app-modal
  title="Add a pet"
  modalSize="large"
  class="modal fade"
  tabindex="-1"
  aria-labelledby="PetAddModal"
  aria-hidden="true"
  id="addPetModal"
>
  <app-pet-add></app-pet-add>
</div>
<div
  app-modal
  title="Confirmation"
  modalSize="small"
  class="modal fade"
  tabindex="-1"
  aria-labelledby="PetDeleteModal"
  aria-hidden="true"
  id="deletePetModal"
>
  <app-pet-delete [pet_id]="petId"></app-pet-delete>
</div>
<div
  app-modal
  title="Edit"
  modalSize="large"
  class="modal fade"
  tabindex="-1"
  aria-labelledby="PetEditModal"
  aria-hidden="true"
  id="editPetModal"
>
  <app-pet-edit [pet]="pet"></app-pet-edit>
</div>
