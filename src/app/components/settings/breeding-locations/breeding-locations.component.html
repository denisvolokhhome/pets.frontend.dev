<div class="breeding-locations-container">
  <div class="header">
    <h2>Breeding Locations</h2>
    <button 
      class="px-4 py-2 bg-primary text-white rounded-lg hover:bg-red-500 transition-colors" 
      (click)="showAddForm()"
      *ngIf="!showForm">
      Add Location
    </button>
  </div>

  <!-- Success Message -->
  <div class="p-4 mb-4 bg-green-100 border border-green-400 text-green-700 rounded-lg" *ngIf="saveSuccess">
    Location saved successfully!
  </div>

  <!-- Error Message (only for non-409 errors) -->
  <div class="p-4 mb-4 bg-red-100 border border-red-400 text-red-700 rounded-lg" *ngIf="saveError && deleteErrorPets.length === 0">
    {{ saveError }}
  </div>

  <!-- Loading Indicator -->
  <div class="loading" *ngIf="isLoading && !showForm">
    Loading locations...
  </div>

  <!-- Location List -->
  <div class="locations-list" *ngIf="!showForm && !isLoading">
    <div class="location-card" *ngFor="let location of locations">
      <div class="location-info">
        <h3>{{ location.name }}</h3>
        <p>{{ location.address1 }}</p>
        <p *ngIf="location.address2">{{ location.address2 }}</p>
        <p>{{ location.city }}, {{ location.state }} {{ location.zipcode }}</p>
        <p>{{ location.country }}</p>
        
        <!-- Pet Names Section -->
        <div class="pets-section" *ngIf="location.pets && location.pets.length > 0">
          <div class="pets-label">
            <i class="bi bi-heart-fill"></i>
            Pets at this location:
          </div>
          <div class="pets-tags">
            <span class="pet-tag" *ngFor="let pet of location.pets">
              {{ pet.name }}
            </span>
          </div>
        </div>
      </div>
      <div class="location-actions">
        <button class="px-4 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 transition-colors" (click)="editLocation(location)">
          Edit
        </button>
        <button class="px-4 py-2 bg-red-500 text-white rounded-lg hover:bg-red-600 transition-colors" (click)="confirmDelete(location)">
          Delete
        </button>
      </div>
    </div>

    <div class="empty-state" *ngIf="locations.length === 0">
      <p>No breeding locations yet. Add your first location to get started.</p>
    </div>
  </div>

  <!-- Location Form -->
  <div class="location-form" *ngIf="showForm">
    <h3>{{ editingLocation ? 'Edit Location' : 'Add New Location' }}</h3>
    
    <form [formGroup]="locationForm" (ngSubmit)="saveLocation()">
      <div class="form-group">
        <label for="name">Location Name *</label>
        <input 
          type="text" 
          id="name" 
          formControlName="name"
          [class.invalid]="isFieldInvalid('name')"
          placeholder="e.g., Main Kennel">
        <div class="error-message" *ngIf="isFieldInvalid('name')">
          Location name is required
        </div>
      </div>

      <div class="form-group">
        <label for="address1">Address Line 1 *</label>
        <input 
          type="text" 
          id="address1" 
          formControlName="address1"
          [class.invalid]="isFieldInvalid('address1')"
          placeholder="Street address">
        <div class="error-message" *ngIf="isFieldInvalid('address1')">
          Address is required
        </div>
      </div>

      <div class="form-group">
        <label for="address2">Address Line 2</label>
        <input 
          type="text" 
          id="address2" 
          formControlName="address2"
          placeholder="Apartment, suite, etc. (optional)">
      </div>

      <div class="form-row">
        <div class="form-group">
          <label for="city">City *</label>
          <input 
            type="text" 
            id="city" 
            formControlName="city"
            [class.invalid]="isFieldInvalid('city')"
            placeholder="City">
          <div class="error-message" *ngIf="isFieldInvalid('city')">
            City is required
          </div>
        </div>

        <div class="form-group">
          <label for="state">State/Province *</label>
          <input 
            type="text" 
            id="state" 
            formControlName="state"
            [class.invalid]="isFieldInvalid('state')"
            placeholder="State">
          <div class="error-message" *ngIf="isFieldInvalid('state')">
            State is required
          </div>
        </div>
      </div>

      <div class="form-row">
        <div class="form-group">
          <label for="zipcode">Zip/Postal Code *</label>
          <input 
            type="text" 
            id="zipcode" 
            formControlName="zipcode"
            [class.invalid]="isFieldInvalid('zipcode')"
            placeholder="Zip code">
          <div class="error-message" *ngIf="isFieldInvalid('zipcode')">
            Zip code is required
          </div>
        </div>

        <div class="form-group">
          <label for="country">Country *</label>
          <input 
            type="text" 
            id="country" 
            formControlName="country"
            [class.invalid]="isFieldInvalid('country')"
            placeholder="Country">
          <div class="error-message" *ngIf="isFieldInvalid('country')">
            Country is required
          </div>
        </div>
      </div>

      <div class="form-actions">
        <button type="submit" class="px-4 py-2 bg-primary text-white rounded-lg hover:bg-red-500 transition-colors" [disabled]="isLoading">
          {{ isLoading ? 'Saving...' : 'Save Location' }}
        </button>
        <button type="button" class="px-4 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 transition-colors" (click)="cancelForm()" [disabled]="isLoading">
          Cancel
        </button>
      </div>
    </form>
  </div>

  <!-- Delete Confirmation Modal -->
  <div class="modal-overlay" *ngIf="showDeleteConfirm" (click)="cancelDelete()">
    <div class="modal-content" (click)="$event.stopPropagation()">
      <h3>{{ deleteErrorPets.length > 0 ? 'Cannot Delete Location' : 'Confirm Delete' }}</h3>
      
      <div *ngIf="deleteErrorPets.length === 0">
        <p>Are you sure you want to delete "{{ locationToDelete?.name }}"?</p>
        <p class="warning">This action cannot be undone.</p>
      </div>
      
      <div *ngIf="deleteErrorPets.length > 0" class="error-content">
        <div class="p-4 mb-4 bg-red-100 border border-red-400 text-red-700 rounded-lg">
          <i class="bi bi-exclamation-triangle-fill"></i>
          {{ saveError }}
        </div>
        <p class="pets-list-header">The following pets are using this location:</p>
        <ul class="pets-list">
          <li *ngFor="let petName of deleteErrorPets">
            <i class="bi bi-dot"></i>
            {{ petName }}
          </li>
        </ul>
        <p class="help-text">Please reassign these pets to a different location before deleting this one.</p>
      </div>
      
      <div class="modal-actions">
        <button 
          *ngIf="deleteErrorPets.length === 0"
          class="px-4 py-2 bg-red-500 text-white rounded-lg hover:bg-red-600 transition-colors" 
          (click)="deleteLocation()" 
          [disabled]="isLoading">
          {{ isLoading ? 'Deleting...' : 'Delete' }}
        </button>
        <button class="px-4 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 transition-colors" (click)="cancelDelete()" [disabled]="isLoading">
          {{ deleteErrorPets.length > 0 ? 'Close' : 'Cancel' }}
        </button>
      </div>
    </div>
  </div>
</div>
